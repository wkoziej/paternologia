{% extends "base.html" %}

{% block title %}{{ song.song.name }} - Paternologia{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <div class="flex items-center gap-4">
        <a href="/" class="text-indigo-600 hover:text-indigo-800">&larr; Powrót</a>
        <h1 class="text-2xl font-bold text-gray-800 uppercase">{{ song.song.name }}</h1>
    </div>
    <div class="flex gap-2">
        <a href="/songs/{{ song.song.id }}/edit"
           class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
            Edytuj
        </a>
        <button hx-delete="/songs/{{ song.song.id }}"
                hx-confirm="Czy na pewno chcesz usunąć ten utwór?"
                class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition">
            Usuń
        </button>
    </div>
</div>

{% if song.song.notes %}
<p class="text-gray-600 mb-6 italic">{{ song.song.notes }}</p>
{% endif %}

<!-- PACER Buttons -->
<section>
    <h2 class="text-lg font-semibold text-gray-700 mb-4">
        PACER ({{ song.pacer | length }} {{ 'przycisk' if song.pacer | length == 1 else 'przyciski' if song.pacer | length < 5 else 'przycisków' }})
    </h2>

    {% if song.pacer %}
    <div style="display: grid; grid-template-columns: repeat(6, minmax(0, 1fr)); gap: 0.5rem; width: 100%;">
        {% for button in song.pacer %}
        {% set button_idx = loop.index %}
        <div class="bg-white rounded-lg shadow overflow-hidden pacer-btn">
            <div class="bg-indigo-600 text-white px-3 py-2 font-bold text-center text-sm">
                #{{ button_idx }} {{ button.name }}
            </div>
            <div class="p-3 action-list space-y-3">
                {% for action in button.actions %}
                {% set device = devices_map.get(action.device) %}
                <div class="border-l-4 pl-2 device-{{ action.device }}">
                    <div class="text-xs text-gray-500">
                        {% if action.label %}{{ action.label }}{% else %}&nbsp;{% endif %}
                    </div>
                    <div class="font-semibold text-sm text-gray-800">
                        {{ device.name if device else action.device }}
                    </div>
                    <div class="text-sm text-gray-700">
                        {% if action.type.value == 'preset' %}
                        preset {{ action.value }}
                        {% elif action.type.value == 'pattern' %}
                        pattern {{ action.value }}
                        {% elif action.type.value == 'cc' %}
                        CC{{ action.cc }}
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
                {% if not button.actions %}
                <p class="text-gray-400 italic text-sm">Brak akcji</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
        <p>Brak skonfigurowanych przycisków PACER</p>
    </div>
    {% endif %}
</section>
{% endblock %}
