# Przegląd SPEC_PACER_EXPORT.md

- **Niespójne wartości typów wiadomości MIDI (`constants.py` vs `mappings.py`)** – w sekcji stałych zdefiniowano `MSG_PROGRAM_CHANGE = 0x43` i `MSG_CC = 0x47`, natomiast przykładowa funkcja `action_type_to_midi()` ma zwracać `0x45` dla presetów. Bez wyjaśnienia skąd pojawia się `0x45` trudno przygotować testy i grozi to generowaniem niepoprawnych bajtów. Usprawnienie: ujednolicić tabelę kodów (najlepiej cytując źródło z dokumentacji Pacera) i dopisać jakie `ActionType` mapują się na które stałe.

- **Brak źródła kanału MIDI w MVP mimo zależności eksportu od kanałów** – opis procesu eksportu (krok 4) wymaga mapowania akcji na kanał MIDI, ale sekcja „Rozszerzenia modeli” podaje `midi_channel` jako opcjonalny dodatek „nie niezbędny w MVP”. Jeśli pole pozostanie niezaimplementowane, funkcja `get_device_channel()` nie ma danych wejściowych i nie wiadomo, jak powinien działać fallback (hardcode w kodzie? w YAML?). Usprawnienie: zdecydować o źródle kanału już w MVP (np. dodać `midi_channel` do `Device` i wymusić go w `devices.yaml`, albo opisać konkretną tabelę hardcodów w specyfikacji).

- **Nieopisany parametr `midi_ctrl` w `build_control_led()`** – metoda przyjmuje `midi_ctrl`, ale spec nie wyjaśnia skąd wziąć tę wartość ani jak powiązać ją z `control_id` lub akcją. To utrudnia implementację oraz testy LED-ów. Usprawnienie: dodać sekcję opisującą relację między `control_id`, numerem MIDI kontrolki (midi_ctrl?) i sposobem pozyskania parametru.

- **Brak ograniczeń długości i kodowania nazw presetów** – krok 3 procesu eksportu mówi o ustawieniu nazwy presetu z `song.song.name`, lecz Pacer ma limit znaków i wymaga ASCII/7-bit. Bez jasnych zasad (truncowanie, transliteracja) generowane nazwy mogą zostać ucięte lub odrzucone przez urządzenie. Usprawnienie: dopisać maksymalną liczbę znaków i strategię normalizacji.

- **Opis concatenacji wiadomości SysEx pomija ramki i separator** – punkt 5 procesu sugeruje „konkatenację wszystkich wiadomości SysEx w jeden bufor bajtów”, ale spec nie podaje czy każda wiadomość ma własne `0xF0...0xF7`, ani czy między wiadomościami powinna być jakakolwiek przerwa/rozmiar. Brak tej informacji utrudnia przygotowanie testów i może spowodować nieczytelne pliki .syx. Usprawnienie: doprecyzować format pliku (np. każda wiadomość `F0 ... F7` jedna po drugiej, brak dodatkowych nagłówków) i podać przykład hexdumpu.

- **UI przykładowe `amidi` zakłada stały port `hw:8,0,0`** – instrukcja w template pokazuje twardo zakodowaną ścieżkę urządzenia. Na większości systemów numer portu będzie inny, więc użytkownik może przypadkowo wysłać dane w złe miejsce. Usprawnienie: zasugerować komendę `amidi -l` i dodać placeholder w UI albo uczynić port parametryzowalnym.
